# NOTE DO NOT DELETE provider: from this file.
service: shell-test

provider:
  name: aws
  vpc: ${{file(../scripts/deploymentMaps.js):vpc}}
  runtime: nodejs8.10
  region: eu-west-2
  stage: ${{self:custom.currentStage}}
  variableSyntax: "\\${{([ ~:a-zA-Z0-9._\\'\",\\-\\/\\(\\)]+?)}}"
  timeout: 30
  environment:
    dbuser: ${{ ssm:tthsDbUser-${{self:custom.currentStage}}~true}}
    dbpassword: ${{ ssm:tthsDbPassword-${{self:custom.currentStage}}~true}}
    rdsdbdev: ${{ ssm:shelldb-${{self:custom.currentStage}}~true}}
    NODE_ENV: ${{self:custom.currentStage}}
  iamRoleStatements:
    - Effect: Allow
      Action:
        - logs:*
        - lambda:*
        - sns:*
        - ses:*
        - cloudwatch:*
        - s3:*
      Resource: "*"
  package:
    include:
      - ./*
      - ../config
custom:
  splitStacks:
    perFunction: false
    perType: true
  prune:
    automatic: true
    number: 3
  defaultStage: test
  currentStage: ${{opt:stage, self:custom.defaultStage}}
  logGroup1: /aws/lambda/shell-test-${{self:custom.currentStage}}-getBalanceHandler
  logGroup2: /aws/lambda/shell-test-${{self:custom.currentStage}}-getBalanceHandler
  alerts:
    global:
      - functionErrors
  deploymentSettings:
    stages:
      - master
  environment:
    NODE_ENV: ${{env:NODE_ENV}}
